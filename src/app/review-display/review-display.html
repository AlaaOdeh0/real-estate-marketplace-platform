<div class="container mt-4 mb-5">
  <div class="card shadow-sm review-card">
    <div class="card-header bg-white border-0 pt-3 pb-0">
       <div class="d-flex align-items-center">
           <button class="btn btn-light me-2 back-button"><i class="bi bi-arrow-left"></i></button>
           <h5 class="mb-0">Customer Feedback</h5>
       </div>
    </div>
    <div class="card-body">
      <div class="text-center mb-4">
        <div class="overall-rating-text">Overall Rating</div>
        <div class="display-2 fw-bold rating-number">{{ overallRating | number:'1.1-1' }}</div>
        <div class="rating-stars-display mb-2">
           <i *ngFor="let star of stars"
             class="bi overall-star-icon"
             [class.bi-star-fill]="star <= overallRating"
             [class.bi-star-half]="star - 0.5 <= overallRating && star > overallRating"
             [class.bi-star]="star - 0.5 > overallRating">
           </i>
        </div>
        <div class="text-muted small">Based on {{ totalReviews }} reviews</div>
      </div>

      <div class="mb-4 rating-breakdown">
        <div class="d-flex align-items-center mb-2">
          <div class="col-label">Excellent</div>
          <div class="col-bar flex-grow-1 px-2">
             <div class="progress" style="height: 8px;">
                 <div class="progress-bar" role="progressbar" [style.width.%]="breakdownPercentages.excellent" [attr.aria-valuenow]="breakdownPercentages.excellent" aria-valuemin="0" aria-valuemax="100"></div>
             </div>
          </div>
        </div>
         <div class="d-flex align-items-center mb-2">
          <div class="col-label">Good</div>
          <div class="col-bar flex-grow-1 px-2">
             <div class="progress" style="height: 8px;">
                 <div class="progress-bar" role="progressbar" [style.width.%]="breakdownPercentages.good" [attr.aria-valuenow]="breakdownPercentages.good" aria-valuemin="0" aria-valuemax="100"></div>
             </div>
          </div>
        </div>
         <div class="d-flex align-items-center mb-2">
          <div class="col-label">Average</div>
          <div class="col-bar flex-grow-1 px-2">
             <div class="progress" style="height: 8px;">
                 <div class="progress-bar" role="progressbar" [style.width.%]="breakdownPercentages.average" [attr.aria-valuenow]="breakdownPercentages.average" aria-valuemin="0" aria-valuemax="100"></div>
             </div>
          </div>
        </div>
         <div class="d-flex align-items-center">
          <div class="col-label">Poor</div>
          <div class="col-bar flex-grow-1 px-2">
             <div class="progress" style="height: 8px;">
                 <div class="progress-bar" role="progressbar" [style.width.%]="breakdownPercentages.poor" [attr.aria-valuenow]="breakdownPercentages.poor" aria-valuemin="0" aria-valuemax="100"></div>
             </div>
          </div>
        </div>
      </div>

      <div class="reviews-list mb-4">
          <h6 class="mb-3">Reviews</h6>
          <app-review-item *ngFor="let review of reviews" [review]="review"></app-review-item>
          <div *ngIf="reviews.length === 0" class="text-center text-muted">
            No reviews yet. Be the first to write one!
          </div>
      </div>

      <div class="text-center">
        <button class="btn btn-write-review w-100" (click)="toggleReviewForm()">
           {{ showReviewForm ? 'Cancel' : 'Write a review' }}
        </button>
      </div>

      <app-leave-review-form *ngIf="showReviewForm" (reviewSubmitted)="handleReviewSubmitted($event)">
      </app-leave-review-form>
    </div>
  </div>
</div>